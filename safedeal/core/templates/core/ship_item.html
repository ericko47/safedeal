{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="max-w-2xl mx-auto mt-10 bg-white p-6 rounded-lg shadow">
    {% comment %} <a href="#" onclick="goBackWithSpinnerFix(event)" class="text-sm text-gray-600 hover:text-blue-600 mb-4">
      &larr; Go Back
    </a> {% endcomment %}
    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Mark Item as Shipped</h2>

    <form method="post" enctype="multipart/form-data" class="space-y-5">
        {% csrf_token %}
        
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Shipping Evidence</label>
            <p>Attach a clear receipt, waybill, or photo showing proof of shipment. This can include a courier receipt, a tracking screenshot, a photo of the packaged item with label, or a signed delivery agent form. Make sure the evidence clearly shows the shipment date, destination, or tracking details.</p>

            <p>Accepted formats: JPG, PNG, PDF</p>
            {{ form.shipping_evidence }}
            {% if form.shipping_evidence.errors %}
                <p class="text-red-500 text-sm">{{ form.shipping_evidence.errors.0 }}</p>
            {% endif %}
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Delivery Mode</label>
            {{ form.delivery_mode }}
            {% if form.delivery_mode.errors %}
                <p class="text-red-500 text-sm">{{ form.delivery_mode.errors.0 }}</p>
            {% endif %}
        </div>

        <div id="agentField" class="hidden">
            <label class="block text-sm font-medium text-gray-700 mb-1">Delivery Agent</label>
            {{ form.delivery_agent }}
            {% if form.delivery_agent.errors %}
                <p class="text-red-500 text-sm">{{ form.delivery_agent.errors.0 }}</p>
            {% endif %}
        </div>

        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded">
            Mark as Shipped
        </button>
    </form>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const modeSelect = document.getElementById("id_delivery_mode");
    const agentField = document.getElementById("agentField");

    function toggleAgentField() {
      if (modeSelect.value === "agent") {
        agentField.classList.remove("hidden");
      } else {
        agentField.classList.add("hidden");
      }
    }

    // Init + change listener
    toggleAgentField();
    modeSelect.addEventListener("change", toggleAgentField);
  });
</script>
{% endblock %}
